<loader [isLoading]="isLoading" />
<div class="container py-3" *ngIf="!isLoading" >
    <h1 *ngIf="entityName === 'movies'" class="title">Films disponibles</h1>
    <h1 *ngIf="entityName === 'places'" class="title">Lieux disponibles</h1>
    <div class="input-group mb-3">
        <input type="text" class="form-control" placeholder="Rechercher {{ entityName === 'movies' ? 'un film' : 'un lieu' }} ..." [(ngModel)]="searchTerm" (input)="filterEntities()">
        <button class="btn btn-outline-primary" type="button" (click)="filterEntities()">Rechercher</button>
    </div>
    <div class="d-flex justify-content-end mt-3">
        <nav aria-label="Pagination">
            <ul class="pagination">
                <li class="page-item" [class.disabled]="currentPage === 1">
                    <a class="page-link"  (click)="previousPage()">Précédent</a>
                </li>
                <li class="page-item" *ngFor="let page of getPages()" [class.active]="currentPage === page">
                    <a class="page-link"  (click)="changePage(page)">{{ page }}</a>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPages()">
                    <a class="page-link"  (click)="nextPage()">Suivant</a>
                </li>
            </ul>
        </nav>
    </div>
    <div class="row justify-content">
        <div class="col-md-3 mb-2 entity-item" *ngFor="let entity of entities">
            <div *ngIf="entityName === 'movies'" class="shadow p-1 border">
                <div class="entity-image">
                    <img [src]="(entity.posterUrl | getLink)" width="100%" height="400px"/>
                </div>
                <div class="card-body">
                    <a [routerLink]="[ '/entity','movies', entity.id ]">
                        <h3 class="card-title mb-1">
                            <strong>{{ entity.title }}</strong>
                        </h3>
                    </a>
                    <div class="d-flex justify-content-center">
                      <review-box [note]="entity.rating || 3" />
                    </div>

                    <div class="d-flex gap-2 py-2">
                        <button class="btn btn-primary w-100" (click)="addReview(entity)" >
                            Noter
                        </button>
                        <button class="btn btn-danger w-100" (click)="displayReview(entity)">
                            Avis
                        </button>
                    </div>
                </div>
            </div>
            <div *ngIf="entityName === 'places'" class="shadow p-1 border">
                <div class="entity-image">
                    <img [src]="(entity.imageUrl | getLink) || 'http://placehold.it/150lieux'" width="100%" height="400px"/>
                </div>
                <div class="card-body">
                    <a [routerLink]="[ '/entity', 'places', entity.id ]">
                        <h3 class="card-title mb-1">
                            <strong>{{ entity.title }}</strong>
                        </h3>
                    </a>

                    <div class="d-flex justify-content-center">
                      <review-box [note]="entity.rating || 3" />
                    </div>

                    <div class="d-flex gap-2 py-2">
                        <button class="btn btn-primary w-100" (click)="addReview(entity)" >
                            Noter
                        </button>
                        <button class="btn btn-danger w-100" (click)="displayReview(entity)">
                            Avis
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="d-flex justify-content-end mt-3">
        <nav aria-label="Pagination">
            <ul class="pagination">
                <li class="page-item" [class.disabled]="currentPage === 1">
                    <a class="page-link"  (click)="previousPage()">Précédent</a>
                </li>
                <li class="page-item" *ngFor="let page of getPages()" [class.active]="currentPage === page">
                    <a class="page-link"  (click)="changePage(page)">{{ page }}</a>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPages()">
                    <a class="page-link"  (click)="nextPage()">Suivant</a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<add-edit-form
  *ngIf="AddEditReview"
  entityName="review"
  [title]="title"
  [model]="reviewModel"
  [entity]="currentData"
  (closeModal)="closeModal()"
  />

  <review-list
  *ngIf="isDisplayReview"
  [currentReviews]="currentReviews"
  (closeModal)="closeModal()"

/>
